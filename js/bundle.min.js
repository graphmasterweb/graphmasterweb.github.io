var t={f:null,bg:null};window.addEventListener("load",(function(){t.f=document.getElementById("canvas").getContext("2d"),
t.bg=document.getElementById("bgcanvas").getContext("2d")}));var e={background:"#ffffff",primary:"#bedbf8",secondary:"#e3f1fe",
cursor:"#ffa0a0",preview:"#d6d6d6",default:"#333333",theme:function(t){"dark"===t?(this.background="#121212",this.primary="#373737",
this.secondary="#242424",this.cursor="#a13131",this.preview="#3d3d3d",this.default="#f3f3f3"):"blue"===t?(this.background="#003153",
this.primary="#28516d",this.secondary="#144160",this.cursor="#a13131",this.preview="#3d3d3d",
this.default="#f3f3f3"):(this.background="#ffffff",this.primary="#bedbf8",this.secondary="#e3f1fe",this.cursor="#ffa0a0",
this.preview="#d6d6d6",this.default="#333333")}};function n(t){
return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){
return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o={get:function(t){
if("object"===("undefined"==typeof localStorage?"undefined":n(localStorage))){var e=localStorage.getItem(t),o=null;try{o=JSON.parse(e)
}catch(t){o=e}return o}return this[t]},set:function(t,e){"string"!=typeof e&&(e=JSON.stringify(e)),
"object"===("undefined"==typeof localStorage?"undefined":n(localStorage))?localStorage.setItem(t,e):this[t]=e},remove:function(t){
"object"===("undefined"==typeof localStorage?"undefined":n(localStorage))?localStorage.removeItem(t):delete this[t]}},i={grid:96,
divisions:8,tooltip:"1",fractions:"0",gridsnap:1,lengthsnap:1,anglesnap:15,endsnap:1,lensnap:12,snap:12,colortheme:"light",
change:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this[t]=e,n&&this.sync()},sync:function(){
this.lensnap=this.grid/this.divisions*this.lengthsnap,this.snap=this.grid/this.divisions*this.gridsnap,
document.getElementById("grid").value=Math.round(9600/this.grid)/100,document.getElementById("divisions").value=this.divisions,
document.getElementById("tooltip").value=this.tooltip,document.getElementById("fractions").value=this.fractions,
document.getElementById("gridsnap").value=this.gridsnap,document.getElementById("lengthsnap").value=this.lengthsnap,
document.getElementById("anglesnap").value=this.anglesnap,document.getElementById("endsnap").value=this.endsnap,
document.getElementById("colortheme").value=this.colortheme,document.body.className=this.colortheme,e.theme(this.colortheme),
o.set("options",this)}};window.addEventListener("load",(function(){var t=o.get("theme");t&&(i.change("colortheme",t,!1),o.remove("theme")),
window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&"light"===i.colortheme&&i.change("colortheme","dark",!1)
;var e=o.get("options");if(e)for(var n in e)i.change(n,e[n],!1);i.sync()}));var s={name:"Drawing",points:[],objects:[],addItem:function(t){
this.objects.push(t),o.set("drawing",this)},addSnap:function(t){this.points.push(t),o.set("drawing",this)},setName:function(t){this.name=t,
o.set("drawing",this)},undo:function(){this.objects.splice(-1,1),this.refresh(),o.set("drawing",this)},clear:function(){this.name="Drawing",
document.getElementById("name").value=this.name,this.points.length=0,this.objects.length=0,this.refresh(),o.set("drawing",this)},
refresh:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(n){if(t.bg.canvas.width=document.body.clientWidth,
t.bg.canvas.height=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),t.bg.translate(.5,.5),
t.bg.fillStyle=e.background,t.bg.fillRect(-1,-1,t.bg.canvas.width+1,t.bg.canvas.height+1),i.grid&&i.divisions){var o,s;for(t.bg.beginPath(),
o=i.grid/i.divisions;o<t.bg.canvas.width;)t.bg.moveTo(Math.round(o),0),t.bg.lineTo(Math.round(o),t.bg.canvas.height),o+=i.grid/i.divisions
;for(s=i.grid/i.divisions;Math.round(s)<t.bg.canvas.height;)t.bg.moveTo(0,Math.round(s)),t.bg.lineTo(t.bg.canvas.width,s),
s+=i.grid/i.divisions;for(t.bg.lineWidth=1,t.bg.strokeStyle=e.secondary,t.bg.stroke(),t.bg.beginPath(),
o=i.grid;o<t.bg.canvas.width;)t.bg.moveTo(Math.round(o),0),t.bg.lineTo(Math.round(o),t.bg.canvas.height),o+=i.grid
;for(s=i.grid;s<t.bg.canvas.height;)t.bg.moveTo(0,Math.round(s)),t.bg.lineTo(t.bg.canvas.width,Math.round(s)),s+=i.grid;t.bg.lineWidth=1,
t.bg.strokeStyle=e.primary,t.bg.stroke()}t.f.canvas.width=document.body.clientWidth,
t.f.canvas.height=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),t.f.translate(.5,.5),t.f.lineCap="square"}
t.f.clearRect(0,0,t.f.canvas.width,t.f.canvas.height),this.objects.forEach((function(n){
n.color?t.f.strokeStyle=n.color:t.f.strokeStyle=e.default,n.width?t.f.lineWidth=n.width:t.f.lineWidth=2,t.f.beginPath(),
"line"===n.type?n.x===n.u&&n.y===n.v?(t.f.arc(n.x,n.y,.75,0,2*Math.PI,!0),t.f.stroke()):(t.f.moveTo(n.x,n.y),t.f.lineTo(n.u,n.v),
t.f.stroke()):"arc"===n.type?(t.f.arc(n.x,n.y,n.r,n.a,n.b,!0),t.f.stroke()):"text"===n.type?(t.f.font='18px "Routed Gothic"',
t.f.fillStyle=n.color||e.default,t.f.fillText(n.text,n.x,n.y-1)):"eraser"===n.type&&(t.f.globalCompositeOperation="destination-out",
t.f.arc(n.x,n.y-t.f.canvas.height,n.r,0,2*Math.PI,!0),t.f.shadowOffsetY=t.f.canvas.height,t.f.shadowColor="#000",t.f.shadowBlur=n.r/4,
t.f.fill(),t.f.globalCompositeOperation="source-over",t.f.shadowOffsetY=0,t.f.shadowBlur=0)})),t.f.lineWidth=2,t.f.strokeStyle=e.preview,
t.f.fillStyle=e.cursor},import:function(){var t=this,e=document.createElement("input");e.setAttribute("type","file"),e.onchange=function(e){
var n=new FileReader,s=e.target.files[0];n.readAsText(s,"utf-8"),n.onload=function(e){var n=JSON.parse(e.target.result),s=n.drawing||n
;t.name=s.name||"Drawing",t.points=s.points||[],t.objects=s.objects||[],s.grid&&i.change("grid",s.grid,!1),
s.divisions&&i.change("divisions",s.divisions,!1),s.tooltip&&i.change("tooltip",s.tooltip,!1),
s.fractions&&i.change("fractions",s.fractions,!1),s.gridsnap&&i.change("gridsnap",s.gridsnap,!1),
s.lengthsnap&&i.change("lengthsnap",s.lengthsnap,!1),s.lensnap&&i.change("lensnap",s.lensnap,!1),
s.anglesnap&&i.change("anglesnap",s.anglesnap,!1),s.snap&&i.change("snap",s.snap,!1),s.endsnap&&i.change("endsnap",s.endsnap,!1);var a={
Red:"#ff4136",Orange:"#ff851b",Yellow:"#ffdc00",Green:"#2ecc40",Blue:"#0074d9",Purple:"#b10dc9"};t.objects.forEach((function(t){
t.colour&&(a[t.colour]&&(t.color=a[t.colour]),delete t.colour)})),document.getElementById("name").value=t.name,i.sync(),o.set("drawing",t),
t.refresh(!0)}},e.click()},xport:function(){var t=JSON.stringify({name:this.name,grid:i.grid,divisions:i.divisions,points:this.points,
objects:this.objects});if(navigator.msSaveBlob)navigator.msSaveBlob(new Blob([t],{type:"application/json"}),this.name+".json");else{
var e=document.createElement("a");e.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(t)),
e.setAttribute("download",this.name+".json"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}},save:function(){
if(t.bg.drawImage(t.f.canvas,-.5,-.5),navigator.msSaveBlob)navigator.msSaveBlob(t.bg.canvas.msToBlob(),this.name+".png");else{
var e=document.createElement("a");e.setAttribute("href",t.bg.canvas.toDataURL("image/png")),e.setAttribute("download",this.name+".png"),
document.body.appendChild(e),e.click(),document.body.removeChild(e)}this.refresh(!0)}},a=!1;window.addEventListener("load",(function(){
if(!o.get("maintab")){o.set("maintab","true"),a=!0;var t=o.get("drawing");t&&(s.name=t.name,s.points=t.points,s.objects=t.objects,
document.getElementById("name").value=s.name,s.refresh(!0))}})),window.addEventListener("pagehide",(function(){o.remove("maintab")})),
window.addEventListener("storage",(function(){var t=o.get("maintab");a&&!t&&o.set("maintab","true")}));var r={active:null,
change:function(t){this.active=t},reset:function(){this.active.reset()},click:function(t,e){this.active.click(t,e)},move:function(t,e){
this.active.move(t,e)}},c={x:0,y:0,load:function(){var e=this;t.f.canvas.addEventListener("mousedown",(function(t){return e.click(t)})),
t.f.canvas.addEventListener("mousemove",(function(t){return e.move(t)})),t.f.canvas.addEventListener("touchend",(function(t){
return e.click(t)})),t.f.canvas.addEventListener("touchmove",(function(t){return e.move(t)})),
t.f.canvas.addEventListener("mouseout",this.hide)},click:function(t){t.touches?(this.x=t.changedTouches[0].pageX,
this.y=t.changedTouches[0].pageY-48):(this.x=t.clientX,this.y=t.clientY),r.click(this.x,this.y)},move:function(t){
t.touches?(this.x=t.touches[0].clientX,this.y=t.touches[0].clientY-48,t.preventDefault()):(this.x=t.clientX,this.y=t.clientY),s.refresh(),
r.move(this.x,this.y)},hide:function(){document.getElementById("coords").style.display="none",s.refresh()}};function d(t){
document.getElementById("help").innerHTML=t}var h={text:"",touch:""};function l(t,e){return e?l(e,t%e):t}function f(t){
var e=Math.round(64*t),n=Math.floor(e/64).toString(),o=e%64;if(o){var i=l(64,o);n+="&#8239;<sup>"+o/i+"</sup>&frasl;<sub>"+64/i+"</sub>"}
return n}function u(t){var e=!1;"string"==typeof t&&(t.search(" rad")>-1&&(e=!0,t.replace(" rad","")),t=parseFloat(t)),
e?(t=-180*t/Math.PI)<0&&(t+=360):t/=i.grid;var n="",o=t;("2"!==i.tooltip||e||(o=t*i.divisions),
"3"!==i.tooltip||e)||(n+=Math.floor(t)+"&prime;&nbsp;",o=t%1*i.divisions);return n+=o="1"===i.fractions?e?function(t){
var e=Math.round(60*t),n=Math.floor(e/60)+"&deg;",o=e%60;return o&&(n+="&nbsp;"+o+"&prime;"),n}(o):f(o):+o.toFixed(4),
"3"!==i.tooltip||e||(n+="&Prime;"),e&&n.search("&deg;")<0&&(n+="&deg;"),n}function g(t,e,n,o){var a=t,r=e,d=n,h=o,l={},f=1,g=1
;i.snap>0&&(f=i.snap),i.lensnap>0&&(g=i.lensnap);var m={};if(m.x=Math.round(a/f)*f,m.y=Math.round(r/f)*f,
m.d=Math.sqrt(Math.pow(a-m.x,2)+Math.pow(r-m.y,2)),i.endsnap>0){1===f&&(m.x=s.points[0][0],m.y=s.points[0][1],
m.d=Math.sqrt(Math.pow(a-s.points[0][0],2)+Math.pow(r-s.points[0][1],2)));for(var p=0;p<s.points.length;p++){
var v=Math.sqrt(Math.pow(a-s.points[p][0],2)+Math.pow(r-s.points[p][1],2));v<=m.d&&(m.x=s.points[p][0],m.y=s.points[p][1],m.d=v)}}l.x=m.x,
l.y=m.y;var y=l.x,b=l.y;if(void 0!==d&&void 0!==h){var w={},x=Math.atan2(r-h,a-d)
;i.anglesnap>0&&(x=(x=Math.round(180*x/Math.PI/i.anglesnap)*i.anglesnap)*Math.PI/180);var E=Math.sqrt(Math.pow(a-d,2)+Math.pow(r-h,2))
;E=Math.round(E/g)*g,w.x=Math.cos(x)*E+d,w.y=Math.sin(x)*E+h,w.d=Math.sqrt(Math.pow(a-w.x,2)+Math.pow(r-w.y,2)),
(i.anglesnap>0||g>1)&&(w.d<=m.d||1==f&&0==i.endsnap)&&(l.x=w.x,l.y=w.y,y=E,b=x+" rad")}
return document.getElementById("coords").innerHTML=u(y)+", "+u(b),document.getElementById("coords").style.display="block",
document.getElementById("coords").style.left=c.x+32+"px",document.getElementById("coords").style.top=c.y-32+"px",{x:l.x,y:l.y}}function m(){
d(h.text+" to set new line start point"),this.points=0,this.coords={},this.coords.type="line",this.click=function(t,e){
this.points=this.points+1,1===this.points?d(h.text+" to set line end point"):2===this.points&&(this.save(),this.reset())},
this.reset=function(){r.change(new m),s.refresh(),r.move(c.x,c.y)},this.move=function(e,n){var o;0===this.points?(o=g(e,n),
this.coords.x=o.x,this.coords.y=o.y):1===this.points&&(o=g(e,n,this.coords.x,this.coords.y),this.coords.u=o.x,this.coords.v=o.y,
t.f.beginPath(),t.f.moveTo(this.coords.x,this.coords.y),t.f.lineTo(this.coords.u,this.coords.v),t.f.stroke()),t.f.beginPath(),
t.f.arc(o.x,o.y,2.5,0,2*Math.PI,!0),t.f.fill()},this.save=function(){var t=document.getElementById("line_color").value
;t&&(this.coords.color=t),this.coords.width=document.getElementById("line_width").value,s.addItem(this.coords),
s.addSnap([this.coords.x,this.coords.y]),s.addSnap([this.coords.u,this.coords.v]),c.hide()}}function p(){
d(h.text+" to set new arc center point"),this.points=0,this.coords={},this.coords.type="arc",this.click=function(t,e){
this.points=this.points+1,
1===this.points?d(h.text+" to set arc radius and start angle"):2===this.points?d(h.text+" to set arc end angle"):3===this.points&&(this.save(),
this.reset())},this.reset=function(){r.change(new p),s.refresh(),r.move(c.x,c.y)},this.move=function(e,n){var o;if(0===this.points)o=g(e,n),
this.coords.x=o.x,this.coords.y=o.y;else if(1===this.points)o=g(e,n,this.coords.x,this.coords.y),
this.coords.a=Math.atan2(o.y-this.coords.y,o.x-this.coords.x),
this.coords.r=Math.round(1e3*Math.sqrt(Math.pow(o.x-this.coords.x,2)+Math.pow(o.y-this.coords.y,2)))/1e3,t.f.beginPath(),
t.f.arc(this.coords.x,this.coords.y,this.coords.r,0,2*Math.PI,!0),t.f.moveTo(this.coords.x,this.coords.y),t.f.lineTo(o.x,o.y),
t.f.stroke();else if(2===this.points){o=g(e,n,this.coords.x,this.coords.y),this.coords.b=Math.atan2(o.y-this.coords.y,o.x-this.coords.x),
this.coords.b===this.coords.a&&(this.coords.b=this.coords.a-2*Math.PI),t.f.beginPath(),
t.f.arc(this.coords.x,this.coords.y,this.coords.r,this.coords.a,this.coords.b,!0),t.f.moveTo(this.coords.x,this.coords.y),
t.f.lineTo(o.x,o.y),t.f.stroke();var i=this.coords.b-this.coords.a;document.getElementById("coords").innerHTML=u(i+" rad")}t.f.beginPath(),
t.f.arc(o.x,o.y,2.5,0,2*Math.PI,!0),t.f.fill()},this.save=function(){var t=document.getElementById("line_color").value
;t&&(this.coords.color=t),this.coords.width=document.getElementById("line_width").value,s.addItem(this.coords),
s.addSnap([this.coords.x,this.coords.y]),
s.addSnap([this.coords.x+this.coords.r*Math.cos(this.coords.a),this.coords.y+this.coords.r*Math.sin(this.coords.a)]),
s.addSnap([this.coords.x+this.coords.r*Math.cos(this.coords.b),this.coords.y+this.coords.r*Math.sin(this.coords.b)]),c.hide()}}function v(){
d(h.text+" to place text"),this.points=0,this.coords={},this.coords.type="text",
this.coords.text=document.getElementById("text-input").value,this.click=function(t,e){""!==this.coords.text&&(this.save(),this.reset())},
this.reset=function(){r.change(new v),s.refresh(),r.move(c.x,c.y)},this.move=function(n,o){var i=g(n,o);this.coords.x=i.x,this.coords.y=i.y,
t.f.beginPath(),t.f.arc(i.x,i.y,2.5,0,2*Math.PI,!0),t.f.fill(),t.f.font='18px "Routed Gothic"',t.f.fillStyle=e.preview,
t.f.fillText(this.coords.text,this.coords.x,this.coords.y-1)},this.save=function(){var t=document.getElementById("line_color").value
;t&&(this.coords.color=t),s.addItem(this.coords),c.hide()}}function y(){d(h.text+" to position eraser"),this.points=0,this.coords={},
this.coords.type="eraser",this.click=function(t,e){this.save(),this.reset()},this.reset=function(){r.change(new y),s.refresh(),
r.move(c.x,c.y)},this.move=function(e,n){0===this.points&&(this.coords.x=e,this.coords.y=n,
0===i.snap?this.coords.r=16:this.coords.r=i.snap-1,t.f.beginPath(),t.f.arc(this.coords.x,this.coords.y,this.coords.r,0,2*Math.PI,!0),
t.f.stroke()),t.f.beginPath(),t.f.arc(e,n,2.5,0,2*Math.PI,!0),t.f.fill()},this.save=function(){s.addItem(this.coords),c.hide()}}
function b(t){t.addEventListener("click",w)}function w(t){({"line-button":function(){r.change(new m)},"arc-button":function(){
r.change(new p)},"text-button":function(){r.change(new v)},"eraser-button":function(){r.change(new y)},"undo-button":function(){s.undo()},
"options-button":function(){document.getElementById("options").style.display="block"},"options-close":function(){
document.getElementById("options").style.display="none"},save:function(){s.save()},export:function(){s.xport()},import:function(){s.import()
},clear:function(){s.clear()}})[t.currentTarget.id]()}function x(t){t.addEventListener("click",E)}function E(t){
"dialog"===t.target.className&&(t.target.style.display="none")}function M(t){t.href.indexOf("#")>0&&t.addEventListener("click",I)}
function I(t){var e,n=document.getElementsByClassName("active");for(e=n.length;e>0;e--)n[e-1].className="";var o=t.target.href
;o=o.substring(o.indexOf("#")+1),document.getElementById(o).className="active",t.target.className="active",t.preventDefault()}function B(t){
t.addEventListener("change",k)}function k(t){({colortheme:function(){i.change("colortheme",t.target.value),s.refresh(!0)},grid:function(){
i.change("grid",96/t.target.value),s.refresh(!0)},divisions:function(){i.change("divisions",t.target.value),s.refresh(!0)},
tooltip:function(){i.change("tooltip",t.target.value)},fractions:function(){i.change("fractions",t.target.value)},gridsnap:function(){
i.change("gridsnap",t.target.value)},lengthsnap:function(){i.change("lengthsnap",t.target.value)},anglesnap:function(){
i.change("anglesnap",t.target.value)},endsnap:function(){i.change("endsnap",t.target.value)}})[t.target.id]()}
window.addEventListener("load",(function(){"ontouchstart"in window?(h.touch="Yes",h.text="Drag"):(h.touch="No",h.text="Click"),
document.getElementById("help").innerHTML=h.text+" to set new line start point"})),window.addEventListener("load",(function(){
document.getElementById("text-input").addEventListener("keyup",(function(){r.change(new v)})),
document.fonts&&document.fonts.ready.then((function(){s.refresh()}))})),window.addEventListener("load",(function(){
var t=document.getElementsByTagName("button");Array.prototype.forEach.call(t,b)})),window.addEventListener("load",(function(){
var t=document.getElementsByClassName("dialog");Array.prototype.forEach.call(t,x)})),window.addEventListener("load",(function(){
var t=document.getElementsByTagName("a");Array.prototype.forEach.call(t,M)})),window.addEventListener("load",(function(){
var t=document.getElementById("options").getElementsByTagName("select");Array.prototype.forEach.call(t,B),
document.getElementById("name").addEventListener("change",(function(t){var e=t.target.value.replace(/[^a-z0-9_\-\s.'()]/gi,"")
;""===e&&(e="Drawing"),s.setName(e),document.getElementById("name").value=e}))})),window.addEventListener("load",(function(){
"serviceWorker"in navigator&&navigator.serviceWorker.register("/worker.js"),document.getElementById("file-link").className="active",
document.getElementById("file").className="active",
document.getElementById("dynamic").setAttribute("href","mail"+decodeURIComponent("to:chrispalmeri%40%67%6d%61%69")+"l.com"),c.load(),
r.change(new m),s.refresh(!0)})),window.addEventListener("resize",(function(){s.refresh(!0)})),
window.addEventListener("keydown",(function(t){var e=t.target.tagName.toLowerCase()
;if("input"!==e&&"select"!==e&&(t.ctrlKey&&90===t.keyCode&&s.undo(),27===t.keyCode&&(r.reset(),
document.getElementById("options").style.display="none"),t.shiftKey&&191===t.keyCode)){var n,o=document.getElementsByClassName("active")
;for(n=o.length;n>0;n--)o[n-1].className="";document.getElementById("shortcuts-link").className="active",
document.getElementById("shortcuts").className="active",document.getElementById("options").style.display="block"}}));
